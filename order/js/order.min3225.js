!function(){let e=UI.func,t={section:void 0,fieldAddr:void 0,fieldTag:void 0,wrapTag:void 0,errorAddr:void 0,errorTag:void 0,timerKeyup:-1,resizeField:function(){var t=this;t.fieldAddr.style.height="0";let r=getComputedStyle(t.fieldAddr,null);var i=parseFloat(r.getPropertyValue("padding-top")),d=parseFloat(r.getPropertyValue("padding-bottom")),a=parseFloat(r.getPropertyValue("border-top-width")),n=parseFloat(r.getPropertyValue("border-bottom-width")),s=(parseFloat(r.getPropertyValue("font-size")),parseFloat(r.getPropertyValue("line-height"))),o=t.fieldAddr.scrollHeight,l=e.hasClass(t.fieldAddr,"multi");if(Math.ceil(s+i+d)>=o){if(l)return e.remClass(t.fieldAddr,"multi"),void t.resizeField()}else if(!l)return e.addClass(t.fieldAddr,"multi"),void t.resizeField();t.fieldAddr.style.height=o+n+a+"px"},checkNeedTag:function(){var t=this;let r=t.fieldAddr.value;(result=r.match(/^(bnb1)[0-9a-z]{38}$/))||(result=r.match(/^G[A-D]{1}[A-Z2-7]{54}$/))||(result=r.match(/^(cosmos)[0-9a-z]{39}$/))?(e.remClass(t.wrapTag,"hidden"),t.fieldTag.setAttribute("placeholder","MEMO"),t.fieldTag.setAttribute("data-tag","MEMO")):(result=r.match(/^r[1-9A-HJ-NP-Za-km-z]{25,34}$/))?(e.remClass(t.wrapTag,"hidden"),t.fieldTag.setAttribute("placeholder","Destination Tag"),t.fieldTag.setAttribute("data-tag","Destination Tag")):(result=r.match(/^[1-9A-Za-z\-_]{48}$/))?(e.remClass(t.wrapTag,"hidden"),t.fieldTag.setAttribute("placeholder","MEMO/Comment"),t.fieldTag.setAttribute("data-tag","MEMO/Comment")):(e.addClass(t.wrapTag,"hidden"),t.fieldTag.setAttribute("data-tag",""),t.fieldTag.value="")},init:function(){var t=this;t.section=e.id("access_address_section"),t.fieldAddr=e.id("access_address"),t.fieldTag=e.id("access_tag"),t.wrapTag=e.id("access_tag_outer"),t.errorAddr=e.id("access_address_error"),t.errorTag=e.id("access_tag_error"),e.bind(t.fieldAddr,"focus",(function(){e.remClass(this,"error"),e.remClass(t.fieldTag,"error")})),e.bind(t.fieldTag,"focus",(function(){e.remClass(this,"error"),e.remClass(t.fieldAddr,"error")})),e.bind(t.fieldAddr,"blur",(function(){e.remClass(this,"error"),e.remClass(t.fieldTag,"error"),clearTimeout(t.timerKeyup)})),e.bind(t.fieldTag,"blur",(function(){e.remClass(this,"error"),e.remClass(t.fieldAddr,"error"),clearTimeout(t.timerKeyup)})),e.bind(t.fieldAddr,"input",(function(){e.remClass(this,"error"),clearTimeout(t.timerKeyup),t.checkNeedTag(),t.resizeField()})),e.bind(t.fieldAddr,"input",(function(){e.remClass(this,"error"),e.remClass(t.fieldAddr,"error"),clearTimeout(t.timerKeyup)})),e.on(t.section,"click",".scanqr",(function(r){(r=r||event).preventDefault();let i=this.closest(".dinput").querySelector(".dinput-field");e.remClass(i,"error"),UI.qrscan({scan:function(e){e=e.match(/(?:\w+:)?(\w+)(?:\?.*)?/i),i.value=e[1],i==t.fieldAddr&&(t.checkNeedTag(),t.resizeField()),i.blur(),this.close()}})})),e.on(t.section,"click",".close",(function(e){(e=e||event).preventDefault(),clearTimeout(t.timerKeyup);let r=this.closest(".dinput").querySelector(".dinput-field");r.value="",r.focus(),r==t.fieldAddr&&(t.checkNeedTag(),t.resizeField())})),UI.button("unlock_submit").click((function(r){var i={id:this.getAttribute("data-id"),addr:t.fieldAddr.value,tag:t.fieldTag.value,tagName:t.fieldTag.getAttribute("data-tag")};if(!i.addr)return r.error(),void e.addClass(t.fieldAddr,"error");APP.api("orderGetAccess",i).then((function(e){r.success(),location.href="/order/"+i.id})).catch((function(i){r.error(),302==i.code?(e.addClass(t.fieldTag,"error"),t.errorTag.innerHTML=i.msg):(e.addClass(t.fieldAddr,"error"),t.errorAddr.innerHTML=i.msg)}))})),window.addEventListener("resize",(function(){t.resizeField()}))}};window.AccessInit=function(){t.init()}}(),function(){let e=UI.func;function t(e){for(let r=0;r<e.length;r++){var t=+e[r].getAttribute("timestamp");if(100<t){let i=moment(moment.unix(t).toDate()).local();t=i.fromNow()+" ("+i.format("lll")+")",e[r].innerHTML!=t&&(e[r].innerHTML=t,e[r].setAttribute("title",t))}}}function r(e){let t=moment(moment.unix(+e).toDate()).local();return t.format("L")+" "+t.format("LT")}let i={keyupWallet:-1,errorInterval:-1,wsTry:!1,wsReady:!1},d={id:"",token:null,timeLeft:0,from:{amount:"",address:"",confirm:null,tx:null,timeBlock:null},to:{amount:"",address:"",confirm:null,tx:null,timeBlock:null},back:{address:"",confirm:null,tx:null,timeBlock:null},status:"",refundonly:!1,emergency:{status:[],choice:"",repeat:"",tmpl:""},timeInterval:-1,timeout:-1,timeUpd:0,html:{action:null,time:null,time_parent:null,time_creation:null,time_tx:null,time_competed:null,head_info:null,details:null,details_more:null,emergency:null},init:function(i){var d=this;d.id=i.id,d.token=i.token,d.timeLeft=i.timeLeft,d.from=i.from,d.to=i.to,d.back=i.back,d.status=i.status,d.refundonly=i.refundonly,d.emergency=i.emergency,d.html={action:e.id("order_action"),time:e.id("order_time"),time_parent:e.id("order_time").parentNode.parentNode,time_creation:e.id("order_time_creation"),time_tx:e.id("order_time_tx"),time_competed:e.id("order_time_competed"),head_info:e.id("order_info"),head_inner:e.id("order_info_inner"),details:e.id("order_details"),details_more:e.id("order_details_more"),emergency:e.id("section_emergency")},t(d.html.details.getElementsByTagName("time")),t(d.html.details_more.getElementsByTagName("time")),d.html.time_creation.innerHTML=r(d.html.time_creation.getAttribute("timestamp")),d.html.time_tx.innerHTML=r(d.html.time_tx.getAttribute("timestamp")),d.html.time_competed.innerHTML=r(d.html.time_competed.getAttribute("timestamp")),0<d.timeLeft&&"NEW"==d.status&&(d.timeInterval=setInterval((function(){d.html.time.setAttribute("data-time",APP.formatTime(--d.timeLeft)),d.timeLeft<=0&&(clearInterval(d.timeInterval),e.addClass("timeline_steps","expired"),e.addClass(d.html.time_parent,"expired"))}),1e3)),d.onResize(),setInterval((function(){t(d.html.details.getElementsByTagName("time")),t(d.html.details_more.getElementsByTagName("time"))}),6e4),window.addEventListener("resize",(function(){d.onResize()}))},update:function(i){var d=this;let a={status:!1,txs:!1,confirm:!1,address:!1,amountFrom:!1,amountTo:!1,emergency:!1};d.status!=i.status&&(d.status=i.status,a.status=!0),i.emergency.status=Array.isArray(i.emergency.status)?i.emergency.status.join(","):i.emergency.status,d.emergency.status!=i.emergency.status&&(d.emergency.status=i.emergency.status,a.emergency=!0),d.emergency.choice!=i.emergency.choice&&(d.emergency.choice=i.emergency.choice,a.emergency=!0),d.emergency.repeat!=i.emergency.repeat&&(d.emergency.repeat=i.emergency.repeat,a.emergency=!0),d.from.tx!=i.from.tx.id&&(d.from.tx=i.from.tx.id,a.txs=!0),d.to.tx!=i.to.tx.id&&(d.to.tx=i.to.tx.id,a.txs=!0),d.back.tx!=i.back.tx.id&&(d.back.tx=i.back.tx.id,a.txs=!0),d.from.address!=i.from.address&&(d.from.address=i.from.address,a.address=!0),d.to.address!=i.to.address&&(d.to.address=i.to.address,a.address=!0),d.back.address!=i.back.address&&(d.back.address=i.back.address,a.address=!0),d.from.confirm!=i.from.tx.confirmations&&(e.id("order_from_tx_confirmations")&&(d.from.confirm=i.from.tx.confirmations,e.id("order_from_tx_confirmations").innerHTML=null!=d.from.confirm?d.from.confirm:""),a.confirm=!0),d.to.confirm!=i.to.tx.confirmations&&(e.id("order_to_tx_confirmations")&&(d.to.confirm=i.to.tx.confirmations,e.id("order_to_tx_confirmations").innerHTML=null!=d.to.confirm?d.to.confirm:""),a.confirm=!0),d.back.confirm!=i.back.tx.confirmations&&(e.id("order_back_tx_confirmations")&&(d.back.confirm=i.back.tx.confirmations,e.id("order_back_tx_confirmations").innerHTML=null!=d.back.confirm?d.back.confirm:""),a.confirm=!0),d.from.amount!=e.minCountToFixed(i.from.amount,6,10)&&(d.from.amount=e.minCountToFixed(i.from.amount,6,10),e.id("order_send_value").innerHTML=d.from.amount+" "+i.from.symbol+(i.from.subSymbol?"<sup>"+i.from.subSymbol+"</sup>":""),a.amountFrom=!0),d.to.amount!=e.minCountToFixed(i.to.amount,6,10)&&(d.to.amount=e.minCountToFixed(i.to.amount,6,10),e.id("order_receive_value").innerHTML=d.to.amount+" "+i.to.symbol+(i.to.subSymbol?"<sup>"+i.to.subSymbol+"</sup>":""),a.amountTo=!0),d.from.timeBlock!=i.from.tx.timeBlock&&(d.from.timeBlock=i.from.tx.timeBlock,d.from.timeBlock&&e.id("order_from_tx_timeblock")&&e.id("order_from_tx_timeblock").setAttribute("timestamp",d.from.timeBlock)),d.to.timeBlock!=i.to.tx.timeBlock&&(d.to.timeBlock=i.to.tx.timeBlock,d.to.timeBlock&&e.id("order_to_tx_timeblock")&&e.id("order_to_tx_timeblock").setAttribute("timestamp",d.to.timeBlock)),d.back.timeBlock!=i.back.tx.timeBlock&&(d.back.timeBlock=i.back.tx.timeBlock,d.back.timeBlock&&e.id("order_back_tx_timeblock")&&e.id("order_back_tx_timeblock").setAttribute("timestamp",d.back.timeBlock));var n=0<=i.emergency.status.indexOf("MORE")&&0<=i.emergency.status.indexOf("LIMIT");d.refundonly="REFUND"==i.emergency.choice&&!n;let s=e.hasClass(d.html.time_tx.parentNode.parentNode,"none");"EXPIRED"!=d.status&&i.from.tx.timeReg?s&&(d.html.time_tx.setAttribute("timestamp",i.from.tx.timeReg),d.html.time_tx.innerHTML=r(i.from.tx.timeReg),e.remClass(d.html.time_tx.parentNode.parentNode,"none")):s||e.addClass(d.html.time_tx.parentNode.parentNode,"none"),s=e.hasClass(d.html.time_competed.parentNode.parentNode,"none"),(i.to.tx.id||i.back.tx.id)&&i.time.finish&&!d.refundonly?s&&(d.html.time_competed.setAttribute("timestamp",i.time.finish),d.html.time_competed.innerHTML=r(i.time.finish),e.remClass(d.html.time_competed.parentNode.parentNode,"none")):e.addClass(d.html.time_competed.parentNode.parentNode,"none"),e.togClass("timeline_pending","emergency-choice","EMERGENCY"==i.status),a.status||a.txs||a.amountFrom||a.emergency?d.getDetails():(t(d.html.details.getElementsByTagName("time")),t(d.html.details_more.getElementsByTagName("time")))},getDetails:function(e){var r=this;clearTimeout(r.timeout),APP.api("orderGetDetails",{id:r.id}).then((function(i){-1==r.timeout&&e||r.setStep(i.data.details,i.data.details_more,i.data.emergency),t(r.html.details.getElementsByTagName("time")),t(r.html.details_more.getElementsByTagName("time")),r.timeout=-1})).catch((function(e){t(r.html.details.getElementsByTagName("time")),t(r.html.details_more.getElementsByTagName("time")),r.timeout=setTimeout((function(){r.getDetails(!0)}),5e3)}))},setStep:function(r,i,d){var n=this;switch(e.remClass(document.querySelectorAll("#timeline_steps li:not(.emergency-choice)"),"active"),"REFUND"==n.status&&(n.status=n.refundonly&&n.back.tx||!n.refundonly&&n.to.tx?"DONE":"WITHDRAW"),"NEW"==n.status&&e.addClass("timeline_new","active"),"PENDING"!=n.status&&"EMERGENCY"!=n.status||e.addClass("timeline_pending","active"),"EXCHANGE"==n.status&&e.addClass("timeline_exchange","active"),n.refundonly&&e.addClass("timeline_done","refund"),"WITHDRAW"==n.status&&e.addClass("timeline_done","active"),n.status,n.status){case"NEW":e.remClass("order_qr","none");break;case"PENDING":case"EXCHANGE":case"WITHDRAW":case"EMERGENCY":clearInterval(n.timeInterval),e.remClass("timeline_steps","expired"),e.addClass("order_qr","none"),n.html.time_parent.setAttribute("class","order-time exchange"),n.html.action.setAttribute("class","order-action exchange"),d&&e.addClass(n.html.time_parent,"emergency");break;case"DONE":clearInterval(n.timeInterval),e.remClass("timeline_steps","expired"),e.addClass("order_qr","none"),n.refundonly?(n.html.time_parent.setAttribute("class","order-time refund"),n.html.action.setAttribute("class","order-action refund")):(n.html.time_parent.setAttribute("class","order-time done"),n.html.action.setAttribute("class","order-action done"));break;case"EXPIRED":e.addClass("timeline_steps","expired"),e.remClass("order_qr","none"),n.html.time_parent.setAttribute("class","order-time expired"),n.html.action.setAttribute("class","order-action expired")}r&&(n.html.details.innerHTML=r,t(n.html.details.getElementsByTagName("time"))),i?(n.html.details_more.innerHTML=i,e.remClass(n.html.details_more,"none"),t(n.html.details_more.getElementsByTagName("time"))):(e.addClass(n.html.details_more,"none"),n.html.details_more.innerHTML=""),d&&n.emergency.tmpl!=d&&(e.addClass(n.html.emergency,"active"),n.html.emergency.innerHTML=d,n.emergency.tmpl=d,"EXPIRED"!=n.status&&"NONE"==n.emergency.choice&&""!=n.emergency.status?n.html.action.insertBefore(n.html.emergency,n.html.action.firstElementChild):e.before("section_timeline",n.html.emergency)),d||(e.remClass(n.html.emergency,"active"),n.html.emergency.innerHTML=""),e.id("emergency_submit")&&a.init()},onResize:function(){var t=this,r=t.html.details.querySelector(".order-data-details"),i=t.html.details.querySelector(".order-data-destination"),d=t.html.details_more.querySelector(".order-data-destination");if(e.hasClass(t.html.action,"new")||e.hasClass(t.html.action,"expired")){let n=r.offsetHeight;var a;r=t.html.head_inner.offsetHeight;i&&700<document.documentElement.clientWidth?(85<(a=i.offsetHeight)||240<n)&&n+a-30>r+10?(e.remClass(t.html.head_info.parentNode,"flex-start"),t.html.details_more.appendChild(i),e.remClass(t.html.details_more,"none")):n>r+10?e.addClass(t.html.head_info.parentNode,"flex-start"):e.remClass(t.html.head_info.parentNode,"flex-start"):d&&((a=d.offsetHeight)<=55&&n<=240||n+a-30<=r+10?(t.html.details.appendChild(d),t.html.details_more.childElementCount||e.addClass(t.html.details_more,"none"),n=t.html.details.offsetHeight,n<=r+10&&e.remClass(t.html.head_info.parentNode,"flex-start")):document.documentElement.clientWidth<=700&&(t.html.details.appendChild(d),t.html.details_more.childElementCount||e.addClass(t.html.details_more,"none"),e.remClass(t.html.head_info.parentNode,"flex-start")))}else i&&document.documentElement.clientWidth<=430?i&&e.hasClass(t.html.details_more,"none")&&(t.html.details_more.appendChild(i),e.remClass(t.html.details_more,"none")):d&&430<document.documentElement.clientWidth&&(t.html.details.appendChild(d),t.html.details_more.childElementCount||e.addClass(t.html.details_more,"none"))}},a={section:void 0,submit:void 0,submitWrap:void 0,refundAddr:void 0,refundTag:void 0,refundAddrErr:void 0,refundTagErr:void 0,init:function(){let t=this;t.section=e.id("section_emergency"),t.submitWrap=e.id("emergency_submit_section"),t.submit=e.id("emergency_submit"),t.refundAddr=e.id("refund_address"),t.refundTag=e.id("refund_tag"),t.refundAddrErr=e.id("refund_address_error"),t.refundTagErr=e.id("refund_tag_error");let r=UI.radio("order_refund");function a(){if(e.remClass(t.refundAddr,"error"),r.value){e.addClass(t.submit,"loading");let i={id:d.id,choice:r.value,template:!0};"REFUND"==r.value&&(i.address=t.refundAddr.value,t.refundTag&&t.refundTag.value&&(i.tag=t.refundTag.value)),APP.api("orderSetEmergency",i).then((function(r){e.remClass(t.submit,"loading"),d.getDetails()})).catch((function(r){switch(e.remClass(t.submit,"loading"),r.code){case 302:case 303:t.refundTag.focus(),e.addClass(t.refundTag,"error"),t.refundTagErr.innerHTML=r.msg;break;default:t.refundAddr.focus(),e.addClass(t.refundAddr,"error"),t.refundAddrErr.innerHTML=r.msg,e.remClass(t.refundTag,"error")}}))}}r.change((function(){e.remClass(t.refundAddr,"error"),e.togClass("refund_address_outer","hidden","REFUND"!=r.value),e.togClass("refund_tag_outer","hidden","REFUND"!=r.value),t.submitWrap.setAttribute("data-choice",r.value),e.addClass(t.submitWrap,"active"),setTimeout((function(){e.addClass(t.submitWrap,"visible-overflow")}),500)})),0<r.inputs.length&&r.inputs[0].click(),e.bind(t.submit,"click",(function(){a()})),e.bind(t.refundAddr,"focus",(function(){e.remClass(t.refundAddr,"error")})),e.bind(t.refundTag,"focus",(function(){e.remClass(t.refundTag,"error")})),e.bind(t.refundAddr,"keydown",(function(e){13==e.keyCode&&e.preventDefault()})),e.bind(t.refundAddr,"keyup",(function(e){13==e.keyCode&&(e.preventDefault(),a())})),e.bind(t.refundAddr,"input",(function(r){clearTimeout(i.keyupWallet),e.remClass(this,"error"),t.resizeRefundField(),this.value&&t.validateRefundAddress()})),e.bind(t.refundAddr,"blur",(function(){e.remClass(this,"error"),clearTimeout(i.keyupWallet),this.value&&t.validateRefundAddress()})),e.bind(t.refundTag,"keydown",(function(e){13==e.keyCode&&e.preventDefault()})),e.bind(t.refundTag,"keyup",(function(e){13==e.keyCode&&(e.preventDefault(),a())})),e.bind(t.refundTag,"input",(function(){clearTimeout(i.keyupWallet),e.remClass(this,"error"),this.value&&t.validateRefundAddress()})),e.bind(t.refundTag,"blur",(function(){e.remClass(this,"error"),clearTimeout(i.keyupWallet),this.value&&t.validateRefundAddress()})),e.on(t.section,"click",".scanqr",(function(t){(t=t||event).preventDefault();let r=this.closest(".dinput").querySelector(".dinput-field");e.remClass(r,"error"),UI.qrscan({scan:function(e){e=e.match(/(?:\w+:)?(\w+)(?:\?.*)?/i),r.value=e[1],r.blur(),this.close()}})})),e.on(t.section,"click",".close",(function(e){(e=e||event).preventDefault(),clearTimeout(i.keyupWallet);let r=this.closest(".dinput").querySelector(".dinput-field");r.value="",r.focus(),t.resizeRefundField()})),window.addEventListener("resize",(function(){t.resizeRefundField()}))},resizeRefundField:function(){var t=this;t.refundAddr.style.height="0";let r=getComputedStyle(t.refundAddr,null);var i=parseFloat(r.getPropertyValue("padding-top")),d=parseFloat(r.getPropertyValue("padding-bottom")),a=parseFloat(r.getPropertyValue("border-top-width")),n=parseFloat(r.getPropertyValue("border-bottom-width")),s=(parseFloat(r.getPropertyValue("font-size")),parseFloat(r.getPropertyValue("line-height"))),o=t.refundAddr.scrollHeight,l=e.hasClass(t.refundAddr,"multi");if(Math.ceil(s+i+d)>=o){if(l)return e.remClass(t.refundAddr,"multi"),void t.resizeRefundField()}else if(!l)return e.addClass(t.refundAddr,"multi"),void t.resizeRefundField();t.refundAddr.style.height=o+n+a+"px"},validateRefundAddress:function(){var t=this;t.refundAddr&&(i.keyupWallet=setTimeout((function(){i.keyupWallet=-1;let r={currency:t.refundAddr.getAttribute("data-ccy"),address:t.refundAddr.value};t.refundTag&&t.refundTag.value&&(r.tag=t.refundTag.value),APP.api("orderAddressInfo",r).then((function(e){})).catch((function(r){switch(r.code){case 302:case 303:t.refundTag.focus(),e.addClass(t.refundTag,"error"),t.refundTagErr.innerHTML=r.msg;break;default:t.refundAddr.focus(),e.addClass(t.refundAddr,"error"),t.refundAddrErr.innerHTML=r.msg,e.remClass(t.refundTag,"error")}}))}),300))}};window.InitOrder=function(t){d.init(t),e.id("emergency_submit")&&a.init();let r=new APP.WSClient("wss://fixedfloat.com/ws");r.init((function(){i.wsTry=!0;let e={channel:"orderChanges",id:d.id};d.token&&(e.token=d.token),this.subscribe(e)})),r.message("subscribed",(function(e){i.wsReady=!0,d.update(e)})),r.message("orderChanges",(function(e){i.wsReady=!0,d.update(e)})),r.error((function(e){i.wsTry=!1,i.wsReady=!1}));let n=!1;setInterval((function(){r.isProblem&&!n&&(n=!0,console.log("WS problem"),APP.api("orderStatus",{id:d.id}).then((function(e){d.update(e.data),n=!1})).catch((function(e){n=!1})))}),3e4),delete window.InitOrder}}();